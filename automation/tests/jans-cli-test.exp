#!/usr/bin/expect -f

set HOST [lindex $argv 0]
set USERNAME [lindex $argv 1]
set timeout -1
set openidinum 970accb6-f8a1-4190-825c-6492d5627223
set umaID 7a55c863-a86b-411b-b71a-0c6c37747a3f
spawn $env(SHELL)
match_max 100000
expect  "$"
send -- "ssh ${USERNAME}@${HOST}"
expect -exact "${HOST}"
send -- "\r"
expect -re "(.*)\n"


send -- "/opt/jans/jans-cli/config-cli.py --no-suggestion"
expect -exact "/opt/jans/jans-cli/config-cli.py --no-suggestion"
send -- "\r"
expect "Selection:"



puts "checking Attriute"

send -- "1"
expect -exact "1" 
send -- "\r"
puts "Gets a list of Gluu attributes"
expect  "Selection:"
send -- "1\r"
expect "limit"

send -- "\r"

expect "pattern"
send -- "\r"
expect "status"
send -- "\r"
expect "Selection:"
send -- "b\r"
expect "Selection:"
puts  "Adds a new attribute"

send -- "2"

expect "2"
send -- "\r"

expect "name"

send -- "myAttr\r"
expect "displayName"
send -- "myAttr\r"

expect "description"
send -- "myAttr\r"

expect "dataType"
send -- "STRING\r"

expect "status"
send -- "ACTIVE\r"

expect "editType"
send -- "ADMIN\r"

expect "viewType"
send -- "ADMIN\r"


expect "Populate optional fields?"
send -- "n\r"

expect "Continue?"
send -- "y\r"





#if { $expect_out(buffer) ne "0" }
# puts $expect_out(0,string) 


#if { $expect_out(1,string)} 
       puts $expect_out(1,string) 


#set var $expect_out(buffer);
#set fid [open /tmp/capture.txt w]
#puts $fid $var

expect "Selection:"
send -- "b\r"
expect "Selection:"
send -- "3"
expect -exact "3"
send -- "\r"

expect "inum:"
send -- "3B47\r"
expect "Selection:"
send -- "3\r"
expect "dataType"

send -- "JSON\r"
expect "Selection:"
send -- "s\r" 

expect "Continue?"
send -- "y\r"
expect "Selection:"
send -- "b\r"
expect "Selection:"
send -- "4\r"

expect "inum:"

send -- "3B47\r"

expect "Selection:"
send -- "b\r"
expect "Selection:"
send -- "6\r"
expect "inum:"
send -- "3B47\r"
expect "op:"
send -- "replace\r"
expect "path:"
send -- "dataType\r"
expect "value"
send -- "STRING\r"
expect "Another patch operation?"
send -- "n\r"
expect "Continue?"
send -- "y\r"
#expect { -re inum=(.*?) {send_error "inum not found" exit} }

send -- "\r"
expect "Selection:"
send -- "b\r"
expect "Selection:"
send -- "b\r"
expect "Selection:"

puts "checking  Default Authentication Method" 

send -- "2\r"
expect "Selection:"
send -- "1\r"
#expect { "defaultAcr" {send_error "inum not found" exit} }
#send -- "\r"
expect "Selection:"
send -- "b\r"
expect "Selection:"
send -- "2\r"
expect "Selection:"
send -- "1\r"
expect "defaultAcr"
send -- "passwd_auth\r"
expect "Selection:"


send -- "s\r"
expect "Continue?"
send -- "y\r"
#expect { "passwd_auth" {send_error "inum not found" exit} }

send -- "b\r"
expect "Selection:"
send -- "b\r"
expect "Selection:"

puts "Cache Configuration"

send -- "3\r"
expect "Selection:"
send -- "1\r"
expect "Selection:"
send -- "b\r"
expect "Selection:"
send -- "2\r"
expect "op:"
send -- "replace\r"
expect "path:"
send -- "memcachedConfiguration/bufferSize\r"
expect "value"
send -- "33768\r"
expect "Another patch operation?"
send -- "n\r"
expect "Continue?"
send -- "y\r"
expect "33768"
send -- "b\r"
expect "Selection:"
send -- "b\r"
expect "Selection:"


puts "Cache Configuration – Memcached"

send -- "4\r"
expect "Selection:"
send -- "1\r"
expect "bufferSize"
send -- "b\r"
expect "Selection:"
send -- "2\r"
expect "Selection:"
send -- "1\r"
expect "bufferSize"
send -- "33456\r"
expect "Selection:"
send -- "s\r"
expect "Continue?"
send -- "y\r"
expect "33456"
send -- "b\r"
expect "Selection:"
send -- "3\r"
expect "Selection:"
expect "op:"
send -- "replace\r"
expect "path:"
send -- "bufferSize\r"
expect "value"
send -- "33768\r"
expect "Another patch operation?"
send -- "n\r"
expect "Continue?"
send -- "y\r"
expect "33768"
send -- "b\r"
expect "Selection:"
send -- "b\r"
expect "Selection:"


puts "Cache Configuration – Redis"


send -- "5\r"
expect "Cache Configuration – Redis"
send -- "1\r"
expect "servers"
send -- "b\r"
expect "Cache Configuration – Redis"
send -- "2\r"
expect "Returns Redis cache configuration"
send -- "1\r"
expect "connectionTimeout"
send -- "33456\r"
expect "Selection:"
send -- "s\r"
expect "Continue?"
send -- "y\r"
expect "33456"
send -- "b\r"
expect "Selection:"
send -- "3\r"
expect "Selection:"
expect "op:"
send -- "replace\r"
expect "path:"
send -- "connectionTimeout\r"
expect "value"
send -- "3000\r"
expect "Another patch operation?"
send -- "n\r"
expect "Continue?"
send -- "y\r"
expect "3000"
send -- "b\r"
expect "Selection:"
send -- "b\r"
expect "Attribute"


puts "Cache Configuration – in-Memory"

send -- "6\r"
expect "Cache Configuration – in-Memory"
send -- "1\r"
expect "defaultPutExpiration"
send -- "b\r"
expect "Cache Configuration – in-Memory"
send -- "2\r"
expect "Returns in-Memory cache configuration"
send -- "1\r"
expect "defaultPutExpiration"
send -- "80\r"
expect "Selection:"
send -- "s\r"
expect "Continue?"
send -- "y\r"
expect "80"
send -- "b\r"
expect "Selection:"
send -- "3\r"
expect "Selection:"
expect "op:"
send -- "replace\r"
expect "path:"
send -- "defaultPutExpiration\r"
expect "value"
send -- "60\r"
expect "Another patch operation?"
send -- "n\r"
expect "Continue?"
send -- "y\r"
expect "60"
send -- "b\r"
expect "Selection:"


puts "Cache Configuration – Native-Persistence"

send -- "7\r"
expect "Cache Configuration – Native-Persistence"
send -- "1\r"
expect "defaultPutExpiration"
send -- "b\r"
expect "Cache Configuration – Native-Persistence"
send -- "2\r"
expect "Returns native persistence cache configuration"
send -- "2\r"
expect "defaultPutExpiration"
send -- "80\r"
expect "Selection:"
send -- "s\r"
expect "Continue?"
send -- "y\r"
expect "80"
send -- "b\r"
expect "Selection:"
send -- "3\r"
expect "Selection:"
expect "op:"
send -- "replace\r"
expect "path:"
send -- "defaultPutExpiration\r"
expect "value"
send -- "60\r"
expect "Another patch operation?"
send -- "n\r"
expect "Continue?"
send -- "y\r"
expect "60"
send -- "b\r"
expect "Selection:"
send -- "b\r"
expect "Attribute"


puts "Configuration – Properties"

send -- "8\r"
expect "Configuration – Properties"
send -- "1\r"
expect "useHighestLevelScriptIfAcrScriptNotFound"
send -- "b\r"
expect "Configuration – Properties"
send -- "3\r"
expect "persistenceType"
send -- "b\r"
expect "Selection:"
send -- "2\r"
expect "op:"
send -- "replace\r"
expect "path:"
send -- "issuer\r"
expect "value"
send -- "http://glubuntu1\r"
expect "Another patch operation?"
send -- "n\r"
expect "Continue?"
send -- "y\r"
expect "http://glubuntu1"
send -- "b\r"
expect "Selection:"
send -- "b\r"
expect "Attribute"


puts "Configuration – Fido2"

send -- "9\r"
expect "Configuration – Fido2"
send -- "1\r"
expect "issuer"
send -- "b\r"
expect "Configuration – Fido2"
send -- "2\r"
expect "Gets Jans Authorization Server Fido2 configuration properties"
send -- "1\r"
expect "baseEndpoint"
send -- "https://gluubuntu/jans-fido2/restv2\r"
expect "Selection:"
send -- "s\r"
expect "Continue?"
send -- "y\r"
expect "https://gluubuntu/jans-fido2/restv2"
send -- "b\r"
expect "Selection:"
send -- "2\r"
expect "Gets Jans Authorization Server Fido2 configuration properties"
send -- "1\r"
expect "baseEndpoint"
send -- "https://gluubuntu/jans-fido2/restv1\r"
expect "Selection:"
send -- "s\r"
expect "Continue?"
send -- "y\r"
expect "https://gluubuntu/jans-fido2/restv1"
send -- "b\r"
expect "Selection:"
send -- "b\r"
expect "Attribute"



puts "Configuration – SMTP"
send -- "10\r"
expect "Configuration – SMTP"
send -- "1\r"
expect "host"
send -- "b\r"
expect "Configuration – SMTP"
send -- "2\r"
expect "host"
send -- "localhost\r"
expect "port"
send -- "12134\r"
expect "requires_ssl"
send -- "\r"
expect "trust_host"
send -- "\r"
expect "from_name"
send -- "manoj\r"
expect "from_email_address"
send  -- "manojsurya78@gmail.com\r"
expect "requires_authentication"
send -- "\r"
expect "user_name"
send -- "manoj\r"
expect "password"
send -- "manoj\r"
expect "Populate optional fields?"
send -- "n\r"
expect "Continue?"
send -- "y\r"
expect  "manojsurya78@gmail.com"
send -- "b\r"
expect "Configuration – SMTP"
send -- "\r"
expect "from_email_address"
send -- "1\r"
expect "from_email_address"
send -- "manojsurya@gmail.com\r"
send -- "s\r"
expect "Continue?"
send -- "y\r"
expect  "manojsurya@gmail.com"
send -- "b\r"
expect "Configuration – SMTP"
send -- "4\r"
expect "Are you sure want to delete"
send -- "y\r"
expect "Entry  was deleted successfully"
send -- "b\r"
expect "Configuration – SMTP"
send -- "b\r"
expect "Attribute"



puts "Configuration – Logging"
send -- "10\r"
expect "Configuration – Logging"
send -- "1\r"
expect "loggingLevel"
send -- "b\r"
expect "Configuration – Logging"
send -- "2\r"
expect "Returns Jans Authorization Server logging settings"
send -- "7\r"
expect "loggingLevel"
send -- "TRACE\r"
expect "Selection:"
send -- "s\r"
expect "Continue?"
send -- "y\r"
expect "TRACE"
send -- "b\r"
expect "Configuration – SMTP"
send -- "b\r"
expect "Attribute"


puts "Database - LDAP configuration"

send -- "14\r"
expect "Database - LDAP configuration"
send -- "1\r"
expect "auth_ldap_server"
send -- "b\r"
expect "Database - LDAP configuration"
send -- "2\r"
expect "configId"
send -- "auth_ldap_server1\r"
expect "bindDN"
send -- "cn=jans,dc=company,dc=org\r"
expect "bindPassword"
send -- "manoj\r"
expect "servers"
send -- "localhost\r"
expect "maxConnections"
send -- "\r"
expect "useSSL"
send -- "true\r"
expect "baseDNs"
send -- "mannoj\r"
expect "primaryKey"
send -- "manoj123\r"
expect "localPrimaryKey"
send -- "manoj123\r"
expect "opulate optional fields?"
send -- "n\r"
expect "Continue?"
send -- "y\r"
expect "auth_ldap_server1"
send -- "b\r"
expect "Database - LDAP configuration"
send -- "3\r"
expect "name:"
send -- "auth_ldap_server1\r"
expect "maxConnections"
send -- "8\r"
expect "maxConnections"
send -- "10\r"
expect "Selection:"
send -- "s\r"
expect "Continue?"
send -- "y\r"
expect "Selection:"
send -- "b\r"
expect "Database - LDAP configuration"
expect "name:"
send -- "auth_ldap_server1\r"
expect "maxConnections"
send -- "b\r"
expect "Database - LDAP configuration"
send -- "6\r"
expect "name:"
send -- "auth_ldap_server1\r"
expect "op:"
send -- "replace\r"
expect "path:"
send -- "maxConnections"
expect "value"
send -- "10\r"
expect "Another patch operation?"
send -- "n\r"
expect "Continue?"
send -- "y\r"
expect "Selection:"
send -- "b\r"
expect "Database - LDAP configuration"
send -- "6\r"
expect "name:"
send -- "auth_ldap_server1\r"
expect "Are you sure want to delete auth_ldap_server1 ?"
send -- "y\r"
expect "Entry auth_ldap_server1 was deleted successfully"
send -- "b\r"
expect "Database - LDAP configuration"
send -- "b\r"
expect "Attribute"

puts "Database - Couchbase configuration"

send -- "15\r"
expect "Database - Couchbase configuration"
send -- "1\r"
expect "Selection:"
send -- "b\r"
expect "Database - Couchbase configuration"
send -- "2\r"
expect "configId"
send -- "couchbasetest\r"
expect "userName"
send -- "couchbasetest\r"
expect "userPassword"
send -- "couchbasetest\r"
expect "servers"
send -- "localhost\r"
expect "defaultBucket"
send -- "couchbasetest\r"
expect "buckets"
send -- "couchbasetest\r"
expect "passwordEncryptionMethod"
send -- "SHA"
expect "sslTrustStoreFile"
send -- "couchbasetest\r
expect "sslTrustStorePin"
send -- "couchbasetest\r"
expect "sslTrustStoreFormat"
send -- "couchbasetest\r"
expect "Populate optional fields?"
send -- "n\r"
expect "Continue?"
send -- "y\r"
expect "couchbasetest"
send -- "b\r"
expect "Database - Couchbase configuration"
send -- "2\r"
expect "name"
send -- "couchbasetest\r"
expect "connectTimeout"
send -- "6\r"
expect "connectTimeout"
send -- "100\r"
expect "Selection"
send -- "s\r"
expect "Continue?"
send -- "y\r"
expect "100"
send -- "b\r"
expect "Database - Couchbase configuration"
send -- "4\r"
expect "name"
send -- "couchbasetest\r"
expect "connectTimeout"
send -- "b\r"
expect "Database - Couchbase configuration"
send -- "5\r"
expect "op:"
send -- "replace\r"
expect "path:"
send -- "connectTimeout\r"
expect "value"
send -- "120\r"
expect "Another patch operation?"
send -- "n\r"
expect "Continue?"
send -- "y\r"
expect "120"
send -- "b\r"
expect "Database - Couchbase configuration"
send -- "6\r"
expect "name"
send -- "couchbasetest\r"
expect "re you sure want to delete couchbasetest ?"
send -- "y\r"
expect  "deleted successfully"
send -- "b\r"
expect "Database - Couchbase configuration"
send -- "b\r"
expect "Attribute"



puts "OAuth - OpenID Connect - Clients"

send -- "16\r"
expect "OAuth - OpenID Connect - Clients"
send -- "1\r"
expect "Gets list of OpenID Connect clients"
send -- "\r"
expect "pattern:"
send -- "\r"
expect "startIndex"
send -- "\r"
expect "sortOrder"
send -- "\r"
expect "backchannelTokenDeliveryMode"
send -- "b\r"
expect "OAuth - OpenID Connect - Clients"
send -- "2\r"
expect "displayName"
send -- "myopenclient\r"
expect "applicationType"
send -- "web\r"
expect "includeClaimsInIdToken"
send -- "\r"
expect "Populate optional fields?"
send -- "n\r"
expect "Continue?"
send -- "y\r"
expect "myopenclient"
#------------------------------------
send -- "b\r"
expect "OAuth - OpenID Connect - Clients"
send -- "3\r"
expect "Get OpenId Connect Client by Inum"
send -- "$openidinum\r"
expect "clientName"
send -- "18\r"
expect "contacts"
send -- "manojsurya78@gmail.com\r"
expect "Selection:"
send -- "s\r"
expect "Continue?"
send -- "y\r"
expect "manojsurya78@gmail.com"
send -- "b\r"
expect "OAuth - OpenID Connect - Clients"

send -- "4\r"
expect "Get OpenId Connect Client by Inum"
send -- "$openidinum\r"
expect "$openidinum"
send -- "b\r"
expect "OAuth - OpenID Connect - Clients"
send -- "6\r"
expect "inum:"
send -- "$openidinum\r"
expect "op:"
send -- "replace\r"
expect "path:"

send -- "clientName\r"
expect "value"
send -- "myopenidclient1\r"
expect "Another patch operation?"
send -- "n\r"
expect "Continue?"
send -- "y\r"
expect "myopenidclient1"  timeout {
    puts "unable to save client name"
   timeout {exit 1}
 expect eof 
} 
send -- "b\r"
expect "OAuth - OpenID Connect - Clients"
#send -- "5\r"
#expect "inum:"
#send -- "$openidinum\r"
#expect "Are you sure want to delete"
#send -- "y\r"
#expect "Selection:"
#send -- "b\r"
#expect "OAuth - OpenID Connect - Clients"
send -- "b\r"
expect "Attribute"

#----------------------------------------------------

puts " UMA resource test started"
send -- "17\r"
expect "OAuth - UMA Resources"
send  -- "2\r"
expect "id:"
send -- "manojUMA\r"
expect "iconUri"
send -- "http://google.com\r"
expect "type"
send -- "WEB\r"
expect "Populate optional fields?"
send -- "y\r"
expect "Selection:"
send -- "8\r"
expect "description"
send -- "umadesc\r"
expect "Selection:"
send -- "#\r"
expect "Selection:"
send -- "1\r"
expect "name"
send -- "UMAresource\r"
expect "Selection:"
send -- "c\r"
expect "Continue?"
send -- "y\r"
expect "UMAresource"
send -- "b\r"
expect "OAuth - UMA Resources"
send  -- "1\r"
expect "limit"
send  -- "\r"
expect "pattern"

send  -- "\r"
expect "UMAresource"
send -- "b\r"
expect "OAuth - UMA Resources"
send  -- "3\r"
expect "id:"
send -- "$umaID\r"
expect "Fields"
send -- "10\r"
expect "name"
send -- "UMAresourceId\r"
expect "Selection:"
send -- "s\r"
expect "Continue?"
send -- "y\r"
expect "UMAresourceId"

send -- "b\r"
expect "OAuth - UMA Resources"

send  -- "4\r"
expect "id:"
send -- "$umaID\r"
expect "$umaID"

send -- "b\r"
expect "OAuth - UMA Resources"

send  -- "6\r"
expect "id:"
send -- "$umaID\r"

expect "op:"
send -- "replace\r"
expect "path:"
send -- "name\r"
expect "value"
send -- "UMAResource\r"
expect "Another patch operation?"
send -- "n\r"

expect "Continue?"
send -- "y\r"
expect "UMAResource"
send -- "b\r"
expect "OAuth - UMA Resources"
send -- "b\r"
expect "Attribute"

#--------------------------------------------------------







send -- "exit\r"
expect -exact "exit"
expect eof

